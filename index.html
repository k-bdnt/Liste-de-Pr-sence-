<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SystÃ¨me de Gestion de PrÃ©sence AvancÃ©</title>

<link rel="stylesheet" href="style.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>
<body>

<header>
    SystÃ¨me de Gestion de PrÃ©sence
</header>

<main>
    <div id="employees" class="tab-content-card">
        ...
    </div>

    <div id="register" class="tab-content-card hidden">
        ...
    </div>

    </main>

<nav class="tab-navigation">
    <button class="tab-button active" onclick="openTab(event, 'employees')">
        <i class="fas fa-chart-line"></i>
        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
    </button>
    <button class="tab-button" onclick="openTab(event, 'register')">
        <i class="fas fa-clock"></i>
        <span>ØªØ³Ø¬ÙŠÙ„ / ØºÙŠØ§Ø¨</span>
    </button>
    <button class="tab-button" onclick="openTab(event, 'table')">
        <i class="fas fa-table"></i>
        <span>Ø§Ù„Ø¬Ø¯ÙˆÙ„</span>
    </button>
    <button class="tab-button" onclick="openTab(event, 'calendar')">
        <i class="fas fa-calendar-alt"></i>
        <span>Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span>
    </button>
    <button class="tab-button" onclick="openTab(event, 'reports')">
        <i class="fas fa-chart-bar"></i>
        <span>ØªÙ‚Ø§Ø±ÙŠØ±</span>
    </button>
    <button class="tab-button" onclick="openTab(event, 'profile')">
        <i class="fas fa-user-circle"></i>
        <span>Ù…Ù„Ù Ø´Ø®ØµÙŠ</span>
    </button>
</nav>

<div id="toast-notification"></div>

<div id="dayDetailsModal" class="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3 id="modalDateTitle" style="color:#D62828;"></h3>
        <p id="modalHolidayInfo" style="margin-bottom: 15px;"></p>
        <ul id="modalDetailsList" style="list-style-type: none; padding: 0;">
            </ul>
        <button onclick="closeModal()" style="margin-top: 15px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script src="script.js"></script>

</body>
</html>
    <hr style="margin-top: 30px; margin-bottom: 30px;">
    <div class="manual-register-section">
        <h3>ğŸ•°ï¸ Saisie Manuelle ou RÃ©troactive</h3>
        <div class="input-group">
            <div><label for="workerSelect">EmployÃ©:</label><select id="workerSelect"><option value="" disabled selected>-- SÃ©lectionner --</option></select></div>
            <div><label for="dateSelect">Date:</label><input type="date" id="dateSelect"></div>
        </div>
        <div class="input-group">
            <div><label for="entryTime">Heure d'EntrÃ©e:</label><input type="time" id="entryTime"></div>
            <div><label for="exitTime">Heure de Sortie:</label><input type="time" id="exitTime"></div>
        </div>
        <div class="input-group">
            <div><label for="breakStart">DÃ©but Pause (Optionnel):</label><input type="time" id="breakStart"></div>
            <div><label for="breakEnd">Fin Pause (Optionnel):</label><input type="time" id="breakEnd"></div>
        </div>
        <textarea id="manualNote" placeholder="TÃ¢ches spÃ©cifiques ou note pour cette saisie (Optionnel)"></textarea>
        <button id="registerButton" onclick="registerPresence()">Enregistrer la PrÃ©sence</button>
        <button onclick="clearForm()" style="background-color: #6c757d; margin-top: 5px;">Annuler / Nouveau Formulaire</button>
    </div>
    <hr style="margin-top: 30px; margin-bottom: 30px;">
    <div class="absence-section">
        <h3>âŒ GÃ©rer les Absences & CongÃ©s (PlanifiÃ© ou pour un jour)</h3>
        <div class="input-group">
            <div><label for="absenceWorker">EmployÃ©:</label><select id="absenceWorker"><option value="" disabled selected>-- SÃ©lectionner --</option></select></div>
            <div><label for="absenceReason">Motif:</label><select id="absenceReason">
                <option value="Maladie">Maladie</option><option value="Permission">Permission</option>
                <option value="Conge_Annuel">CongÃ© Annuel</option><option value="Autre">Autre</option>
            </select></div>
        </div>
        <p style="margin-top: 15px; margin-bottom: 5px;">**PÃ©riode de l'absence:**</p>
        <div class="input-group">
            <div><label for="startDate">Date DÃ©but:</label><input type="date" id="startDate"></div>
            <div><label for="endDate">Date Fin (MÃªme date si un seul jour):</label><input type="date" id="endDate"></div>
        </div>
        <button onclick="registerPlannedAbsence()" style="background-color: #d32f2f;">Planifier/Enregistrer l'Absence</button>
        <p style="margin-top: 25px; border-top: 1px dashed #ddd; padding-top: 10px;">**Absences planifiÃ©es existantes:**</p>
        <ul id="plannedAbsenceList" style="list-style-type: none; padding: 0;"></ul>
    </div>
</div>

<div id="table" class="tab-content-card hidden">
    <h2>ğŸ“Š Tableau des Saisies</h2>
    
    <div class="filter-controls">
        <h3><i class="fas fa-filter"></i> Filtres du Tableau</h3>
        
        <div class="filter-group period-filters">
            <label style="margin-right: 15px;">Filtrer par PÃ©riode:</label>
            <div class="period-filter-dropdown-container">
                 <button id="periodFilterButton" onclick="togglePeriodDropdown()">
                    <i class="fas fa-calendar-alt"></i> 
                    <span id="currentPeriodLabel">Toute la PÃ©riode</span> 
                    <i class="fas fa-caret-down"></i>
                 </button>
                 <div id="periodFilterDropdown" class="hidden">
                    <div class="period-filter-option" data-filter="today" onclick="selectPeriodFilter('today')"><i class="fas fa-calendar-day" style="color:#28a745;"></i> Aujourd'hui</div>
                    <div class="period-filter-option" data-filter="week" onclick="selectPeriodFilter('week')"><i class="fas fa-calendar-week" style="color:#ffc107;"></i> Cette Semaine</div>
                    <div class="period-filter-option" data-filter="month" onclick="selectPeriodFilter('month')"><i class="fas fa-calendar-alt" style="color:#007bff;"></i> Ce Mois</div>
                    <div class="period-filter-option active" data-filter="all" onclick="selectPeriodFilter('all')"><i class="fas fa-infinity" style="color:#6c757d;"></i> Toute la PÃ©riode</div>
                 </div>
            </div>
        </div>

        <div class="filter-group" style="display: block;">
            <label style="display: block; margin-bottom: 5px; margin-top: 10px;">Filtrer par EmployÃ©s (Multi-sÃ©lection):</label>
            <div class="custom-select-container" id="tableSelectContainer">
                <button id="customTableSelectButton" class="custom-select-button" onclick="toggleWorkerDropdown('table')">
                    <span id="selectedTableWorkerCount">-- Tous les employÃ©s (0) --</span>
                    <i class="fas fa-caret-down"></i>
                </button>
                <div id="customTableWorkerSelectDropdown" class="custom-select-dropdown hidden" onmouseleave="closeWorkerDropdown('table')">
                    </div>
            </div>
        </div>
    </div>

    <div class="sort-controls">
        <h3><i class="fas fa-sort"></i> Options de Tri</h3>
        <div class="sort-filter-dropdown-container">
            <button id="sortFilterButton" onclick="toggleSortDropdown()">
                <span id="currentSortLabel">Date (RÃ©cents)</span>
                <i class="fas fa-caret-down"></i>
            </button>
            <div id="sortFilterDropdown" class="hidden">
                 <div class="sort-filter-option active" data-column="date" data-direction="desc" onclick="selectSortOption('date', 'desc', 'Date (RÃ©cents)')"><i class="fas fa-sort-numeric-down"></i> Date (RÃ©cents)</div>
                 <div class="sort-filter-option" data-column="date" data-direction="asc" onclick="selectSortOption('date', 'asc', 'Date (Anciens)')"><i class="fas fa-sort-numeric-up"></i> Date (Anciens)</div>
                 <div class="sort-filter-option" data-column="hours" data-direction="desc" onclick="selectSortOption('hours', 'desc', 'Heures Net (Max)')"><i class="fas fa-sort-amount-down" style="color: #4CAF50;"></i> Heures Net (Max)</div>
                 <div class="sort-filter-option" data-column="hours" data-direction="asc" onclick="selectSortOption('hours', 'asc', 'Heures Net (Min)')"><i class="fas fa-sort-amount-up" style="color: #4CAF50;"></i> Heures Net (Min)</div>
            </div>
        </div>
    </div>

    <div class="table-container"> 
        <table id="presenceTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Nom</th>
                    <th>DÃ©partement</th>
                    <th>EntrÃ©e</th>
                    <th>Sortie</th>
                    <th>Pause (min)</th>
                    <th>H. Net</th>
                    <th>Statut</th>
                    <th>Note</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="calendar" class="tab-content-card hidden">
    <h2>ğŸ“… Calendrier de PrÃ©sence (Cliquez sur un jour pour les dÃ©tails)</h2>
    <select id="calendarWorker" onchange="drawCalendar(currentYear, currentMonth)"><option value="all">Tous les employÃ©s</option></select>
    <div class="calendar-controls">
        <button onclick="prevMonth()" style="width: auto; background-color: #555;"><i class="fas fa-chevron-left"></i> PrÃ©cÃ©dent</button>
        <h3 id="monthYearDisplay"></h3>
        <button onclick="nextMonth()" style="width: auto; background-color: #555;">Suivant <i class="fas fa-chevron-right"></i></button>
    </div>
    <div id="calendarDisplay" class="calendar month-view"></div>
</div>

<div id="reports" class="tab-content-card hidden">
    <h2>ğŸ“ˆ Analyse, Rapports & KPIs</h2>
    <p>SÃ©lectionnez un employÃ© ou "Tous" pour filtrer les rapports:</p>
    <select id="reportsWorkerSelect" onchange="calculateKPIs(); drawChart();">
        <option value="all">Tous les employÃ©s</option>
    </select>
    
    <div class="kpi-container" style="margin-top: 25px;">
        <div class="kpi-card">
            <h4>Taux d'Absence Global (Mois)</h4>
            <span id="kpiAbsenceRate" class="kpi-value">--%</span>
        </div>
        <div class="kpi-card">
            <h4>Moyenne H. Net par Jour (Mois)</h4>
            <span id="kpiAvgHours" class="kpi-value">-- h</span>
        </div>
        <div class="kpi-card">
            <h4>Total Heures Net (Mois)</h4>
            <span id="kpiTotalHoursMonth" class="kpi-value">-- h</span>
        </div>
    </div>
    
    <h3 style="margin-top: 30px;">SynthÃ¨se de Performance Mensuelle par EmployÃ©</h3>
    <div class="table-container">
        <table id="monthlyReportTable" style="width: 100%;">
            <thead>
                <tr>
                    <th>EmployÃ©</th>
                    <th>Total Heures (Mois)</th>
                    <th>Jours d'Absence</th>
                    <th>Moy. Retard EntrÃ©e</th>
                </tr>
            </thead>
            <tbody></tobody>
        </table>
    </div>

    <h3 style="margin-top: 30px;">Graphique d'Heures de Travail par EmployÃ©</h3>
    <canvas id="hoursChart" style="margin-top: 10px;"></canvas>
</div>

<div id="profile" class="tab-content-card hidden">
    <h2>ğŸ‘¤ DÃ©tails du Profil & Modification</h2>
    <p>SÃ©lectionnez un employÃ© pour visualiser/modifier ses informations:</p>
    <select id="profileWorkerSelect" onchange="loadWorkerProfile()"><option value="" disabled selected>SÃ©lectionner un employÃ©</option></select>
    
    <div id="workerProfileDetails" class="profile-details-card hidden" style="border: 1px solid #ccc; padding: 20px; border-radius: 8px; margin-top: 15px; background-color: #fcfcfc;">
        <div class="profile-image-container">
            <img id="profileImage" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/></svg>" alt="Image Profil">
            <input type="file" id="profileImageUpload" accept="image/*" style="margin-top: 10px; width: auto; padding: 5px;" onchange="previewProfileImage(event)">
        </div>
        
        <h3 style="margin-top: 15px;">âš™ï¸ Informations de base</h3>
        <label for="editName">Nom Complet:</label>
        <input type="text" id="editName" placeholder="Nouveau Nom">
        
        <label for="editDept">DÃ©partement:</label>
        <input type="text" id="editDept" placeholder="Nouveau DÃ©partement">
        
        <div class="input-group">
            <div><label for="editEntry">EntrÃ©e par dÃ©faut:</label><input type="time" id="editEntry"></div>
            <div><label for="editExit">Sortie par dÃ©faut:</label><input type="time" id="editExit"></div>
        </div>
        
        <button onclick="saveWorkerProfile()" style="background-color: #4CAF50; margin-top: 15px;"><i class="fas fa-save"></i> Sauvegarder les Modifications</button>

        <hr style="margin: 30px 0;">
        
        <h3 style="margin-top: 0;">ğŸ¯ Performance du Mois</h3>
        
        <div class="profile-kpi-container">
            <div class="profile-kpi-card">
                <h4><i class="fas fa-hourglass-half profile-icon" style="color:#007bff;"></i> Total Heures Net</h4>
                <span id="profileTotalHours" class="profile-value">0.00h</span>
            </div>
            <div class="profile-kpi-card">
                <h4><i class="fas fa-percentage profile-icon" style="color:#4CAF50;"></i> Taux de Punch</h4>
                <span id="profilePunchRate" class="profile-value">--%</span>
            </div>
            <div class="profile-kpi-card">
                <h4><i class="fas fa-calendar-times profile-icon" style="color:#dc3545;"></i> Jours d'Absence (Net)</h4>
                <span id="profileAbsenceDays" class="profile-value">0</span>
            </div>
             <div class="profile-kpi-card">
                <h4><i class="fas fa-stopwatch profile-icon" style="color:#FFC107;"></i> Jours de Retard</h4>
                <span id="profileLatenessDays" class="profile-value">0</span> 
            </div>
        </div>

        <hr style="margin: 30px 0;">

        <h3 style="margin-top: 0;">ğŸ“ˆ Analyse d'AssiduitÃ© (Mois Actuel)</h3>
        <div style="width: 100%; max-width: 300px; margin: 15px auto;">
            <canvas id="profileAttendanceChart"></canvas>
        </div>
    </div>
</div>

<div id="export" class="tab-content-card hidden">
    <h2>ğŸ’¾ Exportation et Sauvegarde</h2>
    <p>Utilisez ces boutons pour sauvegarder vos donnÃ©es ou les exporter au format Excel (.xlsx).</p>
    <button onclick="exportDataToExcel('all')" style="background-color: #1e7e34;"><i class="fas fa-file-excel"></i> Exporter TOUTES les Saisies (Excel)</button>
    <p style="margin-top: 20px;">**Sauvegarde de la configuration actuelle:**</p>
    <button onclick="backupData()" style="background-color: #555;"><i class="fas fa-cloud-download-alt"></i> Sauvegarder (TÃ©lÃ©charger le JSON)</button>
    <p style="margin-top: 20px;">**Restaurer les donnÃ©es:**</p>
    <input type="file" id="restoreFile" accept=".json" style="margin-bottom: 10px;">
    <button onclick="restoreData()" style="background-color: #dc3545;"><i class="fas fa-upload"></i> Restaurer (Importer le JSON)</button>
</div>

</main>

<div class="tab-navigation">
    <button class="tab-button active" onclick="openTab(event, 'employees')"><i class="fas fa-home"></i> Accueil</button>
    <button class="tab-button" onclick="openTab(event, 'register')"><i class="fas fa-sign-in-alt"></i> Saisie</button>
    <button class="tab-button" onclick="openTab(event, 'table')"><i class="fas fa-list-alt"></i> Tableau</button>
    <button class="tab-button" onclick="openTab(event, 'calendar')"><i class="fas fa-calendar-alt"></i> Calendrier</button>
    <button class="tab-button" onclick="openTab(event, 'reports')"><i class="fas fa-chart-line"></i> Rapports</button>
    <button class="tab-button" onclick="openTab(event, 'profile')"><i class="fas fa-user-circle"></i> Profil</button>
    <button class="tab-button" onclick="openTab(event, 'export')"><i class="fas fa-file-export"></i> Export</button>
</div>

<div id="dayDetailsModal" class="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3 id="modalDateTitle"></h3>
        <p style="font-weight: bold;" id="modalHolidayInfo"></p>
        <hr>
        <h4>DÃ©tails de PrÃ©sence/Absence:</h4>
        <ul id="modalDetailsList" style="list-style-type: none; padding: 0;">
            </ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="script.js"></script>
</body>
</html>
